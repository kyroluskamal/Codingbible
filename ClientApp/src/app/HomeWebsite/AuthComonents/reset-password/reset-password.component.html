<app-home-nav-menu></app-home-nav-menu>
<div class="container vh-100 d-flex flex-column justify-content-center align-items-center">
    <mat-card class="d-flex flex-column align-items-center p-0">
        <div class="bg-primary w-100 text-center text-white rounded-top">
            <p class="py-3 h5 ">Reset password</p>
        </div>
        <!-- <mat-card-subtitle>Sign in to our store</mat-card-subtitle> -->

        <form [formGroup]="Form"
              *Shell_NoRender
              (ngSubmit)="Form.valid">
            <div class="form-container calibri-font p-3">
                <div class="alert alert-danger"
                     data-testid="invalidErrors"
                     id="invalidErrors"
                     *ngIf="(ValidationErrors|async)?.length!>0">
                    <p><strong>{{FormValidationErrors.PleaseCorrectErrors}}</strong></p>
                    <ul>
                        <li *ngFor="let error of (ValidationErrors|async)">
                            <strong>{{error.key}}</strong> : {{error.message}}
                        </li>
                    </ul>
                </div>

                <!-- ----------------------------------------------------------------------------------
                ||                                Password                                            ||  
                --------------------------------------------------------------------------------------->
                <mat-form-field [appearance]="defaultFormAppearance"
                                class="w-100">
                    <mat-label><span>{{FormFieldsNames.authForm.Passowrd}}</span></mat-label>
                    <input matInput
                           #password
                           [tooltip]="PasswordValidations"
                           placement="right"
                           container="body"
                           boundariesElement="window"
                           [isOpen]="Form.get(FormControlNames.authForm.password)?.errors&&password.value?true:false"
                           triggers="focus"
                           [type]="InputFieldTypes.password"
                           value=""
                           required
                           [minlength]="PASSWORD_MINLENGTH"
                           [errorStateMatcher]="customErrorStateMatcher"
                           [formControlName]="FormControlNames.authForm.password" />
                    <mat-icon matSuffix
                              (click)="password.type===InputFieldTypes.password?
                              password.type=InputFieldTypes.text:password.type===InputFieldTypes.text?
                              password.type=InputFieldTypes.password:''">
                        <span class="material-icons">
                            {{password.type===InputFieldTypes.password?'visibility':'visibility_off'}}
                        </span>
                    </mat-icon>

                    <mat-error
                               *ngIf="Form.get(FormControlNames.authForm.password)?.hasError(FormValidationErrorsNames.required)">
                        {{FormValidationErrors.RequiredField}}
                    </mat-error>
                    <ng-template #PasswordValidations>
                        <ul class="text-start"
                            *ngIf="!Form.get(FormControlNames.authForm.password)?.value">
                            <li>
                                {{FormValidationErrors.Password.minLength}}
                            </li>
                            <li>
                                {{FormValidationErrors.Password.hasCapitalCase}}
                            </li>
                            <li>
                                {{FormValidationErrors.Password.hasNumber}}
                            </li>
                            <li>
                                {{FormValidationErrors.Password.hasSmallCase}}
                            </li>
                            <li>
                                {{FormValidationErrors.Password.hasSpecialCharacters}}
                            </li>
                        </ul>
                        <ul class="text-start"
                            *ngIf="Form.get(FormControlNames.authForm.password)?.value">
                            <li *ngIf="
                            Form.get(FormControlNames.authForm.password)?.
                                 hasError(FormValidationErrorsNames.password.minLength)">
                                {{FormValidationErrors.Password.minLength}}
                            </li>
                            <li *ngIf="Form.get(FormControlNames.authForm.password)?.
                            hasError(FormValidationErrorsNames.password.hasCapitalCase)">
                                {{FormValidationErrors.Password.hasCapitalCase}}
                            </li>
                            <li *ngIf="Form.get(FormControlNames.authForm.password)?.
                            hasError(FormValidationErrorsNames.password.hasNumber)">
                                {{FormValidationErrors.Password.hasNumber}}
                            </li>
                            <li *ngIf="Form.get(FormControlNames.authForm.password)?.
                            hasError(FormValidationErrorsNames.password.hasSmallCase)">
                                {{FormValidationErrors.Password.hasSmallCase}}
                            </li>
                            <li *ngIf="Form.get(FormControlNames.authForm.password)?.
                            hasError(FormValidationErrorsNames.password.hasSpecialCharacters)">
                                {{FormValidationErrors.Password.hasSpecialCharacters}}
                            </li>
                        </ul>
                    </ng-template>
                </mat-form-field>
                <!-- ----------------------------------------------------------------------------------
            ||                                Confirm Password                                    ||  
            --------------------------------------------------------------------------------------->
                <mat-form-field [appearance]="defaultFormAppearance"
                                class="w-100">
                    <mat-label><span>{{FormFieldsNames.authForm.ConfirmPassword}}</span></mat-label>
                    <input matInput
                           #ConfirmPassword
                           [type]="InputFieldTypes.password"
                           value=""
                           required
                           [minlength]="PASSWORD_MINLENGTH"
                           [errorStateMatcher]="customErrorStateMatcher"
                           [formControlName]="FormControlNames.authForm.confirmpassword" />
                    <mat-icon matSuffix
                              (click)="ConfirmPassword.type===InputFieldTypes.password?
          ConfirmPassword.type=InputFieldTypes.text:ConfirmPassword.type===InputFieldTypes.text?
          ConfirmPassword.type=InputFieldTypes.password:''">
                        <span class="material-icons cursor-pointer">
                            {{ConfirmPassword.type===InputFieldTypes.password?'visibility':'visibility_off'}}
                        </span>
                    </mat-icon>
                    <mat-error
                               *ngIf="Form.get(FormControlNames.authForm.confirmpassword)?.hasError(FormValidationErrorsNames.required)">
                        {{FormValidationErrors.RequiredField}}
                    </mat-error>
                    <mat-error
                               *ngIf="Form.get(FormControlNames.authForm.confirmpassword)?.hasError(FormValidationErrorsNames.password.NoPassswordMatch)">
                        {{FormValidationErrors.Password.NoPassswordMatch}}
                    </mat-error>
                </mat-form-field>
                <!------------------------Mat-Dialog-actions--------------------------->
                <div>
                    <button mat-raised-button
                            color="primary"
                            data-testid="ResetPasswordBtn"
                            dir="ltr"
                            [disabled]="Form.invalid || (Form.valid && (loading|async)) || !email||!token"
                            class="w-100 mt-3"
                            aria-label="press to login"
                            (click)="OnSubmit()">
                        <mat-icon *ngIf="(loading|async)">
                            <mat-spinner diameter="20"
                                         color="warn"></mat-spinner>
                        </mat-icon>
                        {{(Form.valid || Form.invalid) && !(loading|async)?FormConstants.ResetPassword:''}}
                    </button>
                </div>
                <!--End Mat-Dialog-actions-->
            </div>

        </form>
    </mat-card>
</div>